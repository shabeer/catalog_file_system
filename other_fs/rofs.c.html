<html>
<head>
  <title>rofs.c</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<font color="#444444">/*
 * ROFS - The read-only filesystem for FUSE.
 * Copyright 2006 Matthew Keller. kellermg@potsdam.edu and others.
 * v2006.11.28
 * 
 * Mount any filesytem, or folder tree read-only, anywhere else.
 * No warranties. No guarantees. No lawyers.
 * 
 * I read (and borrowed) a lot of other FUSE code to write this. 
 * Similarities possibly exist- Wholesale reuse as well of other GPL code.
 * Special mention to Rémi Flament and his loggedfs.
 * 
 * Consider this code GPLv2.
 * 
 * Compile: gcc -o rofs -Wall -ansi -W -std=c99 -g -ggdb -D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -lfuse 
main.c
 * Mount: rofsmount readwrite_filesystem mount_point
 * 
 */</font>


<font color="0000ff"><strong>#define FUSE_USE_VERSION 25</strong></font>

<font color="0000ff"><strong>#include <font color="#008000">&lt;sys/types.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;sys/stat.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;sys/statvfs.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;stdio.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;strings.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;stdlib.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;string.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;assert.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;errno.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;fcntl.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;sys/xattr.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;dirent.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;unistd.h&gt;</font></strong></font>
<font color="0000ff"><strong>#include <font color="#008000">&lt;fuse.h&gt;</font></strong></font>


// <font color="#2040a0">Global</font> <font color="#2040a0">to</font> <font color="#2040a0">store</font> <font color="#2040a0">our</font> <font color="#2040a0">read</font><font color="4444FF">-</font><font color="#2040a0">write</font> <font color="#2040a0">path</font>
<strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">rw_path</font><font color="4444FF">;</font>

// <font color="#2040a0">Translate</font> <font color="#2040a0">an</font> <font color="#2040a0">rofs</font> <font color="#2040a0">path</font> <font color="#2040a0">into</font> <font color="#2040a0">it</font>'<font color="#2040a0">s</font> <font color="#2040a0">underlying</font> <font color="#2040a0">filesystem</font> <font color="#2040a0">path</font>
<strong>static</strong> <strong>char</strong><font color="4444FF">*</font> <font color="#2040a0">translate_path</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong><font color="4444FF">*</font> <font color="#2040a0">path</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>

    <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">rPath</font><font color="4444FF">=</font> <font color="#2040a0">malloc</font><font color="4444FF">(</font><strong>sizeof</strong><font color="4444FF">(</font><strong>char</strong><font color="4444FF">)</font><font color="4444FF">*</font><font color="4444FF">(</font><font color="#2040a0">strlen</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">+</font><font color="#2040a0">strlen</font><font color="4444FF">(</font><font color="#2040a0">rw_path</font><font color="4444FF">)</font><font color="4444FF">+</font><font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">;</font>
 
    <font color="#2040a0">strcpy</font><font color="4444FF">(</font><font color="#2040a0">rPath</font>,<font color="#2040a0">rw_path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">rPath</font><font color="4444FF">[</font><font color="#2040a0">strlen</font><font color="4444FF">(</font><font color="#2040a0">rPath</font><font color="4444FF">)</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">=</font><font color="4444FF">=</font><font color="#008000">'/'</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">rPath</font><font color="4444FF">[</font><font color="#2040a0">strlen</font><font color="4444FF">(</font><font color="#2040a0">rPath</font><font color="4444FF">)</font><font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">]</font><font color="4444FF">=</font><font color="#008000">'<font color="#77dd77">\0</font>'</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <font color="#2040a0">strcat</font><font color="4444FF">(</font><font color="#2040a0">rPath</font>,<font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>

    <strong>return</strong> <font color="#2040a0">rPath</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>


<font color="#444444"><i>/******************************
 *   
 * Callbacks for FUSE
 * 
 * 
 * 
 ******************************/</i></font>
 
<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_getattr</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>struct</strong> <font color="#2040a0">stat</font> <font color="4444FF">*</font><font color="#2040a0">st_data</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
	
    <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">lstat</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">st_data</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_readlink</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">buf</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
   	<strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
	
    <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">readlink</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">buf</font>, <font color="#2040a0">size</font> <font color="4444FF">-</font> <font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <font color="#2040a0">buf</font><font color="4444FF">[</font><font color="#2040a0">res</font><font color="4444FF">]</font> <font color="4444FF">=</font> <font color="#008000">'<font color="#77dd77">\0</font>'</font><font color="4444FF">;</font>
    <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_readdir</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>void</strong> <font color="4444FF">*</font><font color="#2040a0">buf</font>, <font color="#2040a0">fuse_fill_dir_t</font> <font color="#2040a0">filler</font>,<font color="#2040a0">off_t</font> <font color="#2040a0">offset</font>, <strong>struct</strong> 
<font color="#2040a0">fuse_file_info</font> <font color="4444FF">*</font><font color="#2040a0">fi</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <font color="#2040a0">DIR</font> <font color="4444FF">*</font><font color="#2040a0">dp</font><font color="4444FF">;</font>
    <strong>struct</strong> <font color="#2040a0">dirent</font> <font color="4444FF">*</font><font color="#2040a0">de</font><font color="4444FF">;</font>
    <strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>

    <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">offset</font><font color="4444FF">;</font>
    <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">fi</font><font color="4444FF">;</font>

    <font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>

    <font color="#2040a0">dp</font> <font color="4444FF">=</font> <font color="#2040a0">opendir</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">dp</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
        <strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>

    <strong>while</strong><font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">de</font> <font color="4444FF">=</font> <font color="#2040a0">readdir</font><font color="4444FF">(</font><font color="#2040a0">dp</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF">!</font><font color="4444FF">=</font> <font color="#2040a0">NULL</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>struct</strong> <font color="#2040a0">stat</font> <font color="#2040a0">st</font><font color="4444FF">;</font>
        <font color="#2040a0">memset</font><font color="4444FF">(</font><font color="4444FF">&amp;</font><font color="#2040a0">st</font>, <font color="#FF0000">0</font>, <strong>sizeof</strong><font color="4444FF">(</font><font color="#2040a0">st</font><font color="4444FF">)</font><font color="4444FF">)</font><font color="4444FF">;</font>
        <font color="#2040a0">st</font>.<font color="#2040a0">st_ino</font> <font color="4444FF">=</font> <font color="#2040a0">de</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">d_ino</font><font color="4444FF">;</font>
        <font color="#2040a0">st</font>.<font color="#2040a0">st_mode</font> <font color="4444FF">=</font> <font color="#2040a0">de</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">d_type</font> <font color="4444FF">&lt;</font><font color="4444FF">&lt;</font> <font color="#FF0000">12</font><font color="4444FF">;</font>
        <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">filler</font><font color="4444FF">(</font><font color="#2040a0">buf</font>, <font color="#2040a0">de</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">d_name</font>, <font color="4444FF">&amp;</font><font color="#2040a0">st</font>, <font color="#FF0000">0</font><font color="4444FF">)</font><font color="4444FF">)</font>
            <strong>break</strong><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>

    <font color="#2040a0">closedir</font><font color="4444FF">(</font><font color="#2040a0">dp</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_mknod</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <font color="#2040a0">mode_t</font> <font color="#2040a0">mode</font>, <font color="#2040a0">dev_t</font> <font color="#2040a0">rdev</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">mode</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">rdev</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_mkdir</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <font color="#2040a0">mode_t</font> <font color="#2040a0">mode</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">mode</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_unlink</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_rmdir</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_symlink</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">from</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">to</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">from</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">to</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>	
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_rename</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">from</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">to</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">from</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">to</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_link</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">from</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">to</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">from</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">to</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_chmod</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <font color="#2040a0">mode_t</font> <font color="#2040a0">mode</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">mode</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
    
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_chown</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <font color="#2040a0">uid_t</font> <font color="#2040a0">uid</font>, <font color="#2040a0">gid_t</font> <font color="#2040a0">gid</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">uid</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">gid</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_truncate</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <font color="#2040a0">off_t</font> <font color="#2040a0">size</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">size</font><font color="4444FF">;</font>
  	<strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_utime</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>struct</strong> <font color="#2040a0">utimbuf</font> <font color="4444FF">*</font><font color="#2040a0">buf</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">buf</font><font color="4444FF">;</font>
  	<strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>	
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_open</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>struct</strong> <font color="#2040a0">fuse_file_info</font> <font color="4444FF">*</font><font color="#2040a0">finfo</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
	
	<font color="#444444">/* We allow opens, unless they're tring to write, sneaky
	 * people.
	 */</font>
	<strong>int</strong> <font color="#2040a0">flags</font> <font color="4444FF">=</font> <font color="#2040a0">finfo</font><font color="4444FF">-</font><font color="4444FF">&gt;</font><font color="#2040a0">flags</font><font color="4444FF">;</font>
	
	<strong>if</strong> <font color="4444FF">(</font><font color="4444FF">(</font><font color="#2040a0">flags</font> <font color="4444FF">&amp;</font> <font color="#2040a0">O_WRONLY</font><font color="4444FF">)</font> <font color="4444FF">|</font><font color="4444FF">|</font> <font color="4444FF">(</font><font color="#2040a0">flags</font> <font color="4444FF">&amp;</font> <font color="#2040a0">O_RDWR</font><font color="4444FF">)</font> <font color="4444FF">|</font><font color="4444FF">|</font> <font color="4444FF">(</font><font color="#2040a0">flags</font> <font color="4444FF">&amp;</font> <font color="#2040a0">O_CREAT</font><font color="4444FF">)</font> <font color="4444FF">|</font><font color="4444FF">|</font> <font color="4444FF">(</font><font color="#2040a0">flags</font> <font color="4444FF">&amp;</font> <font color="#2040a0">O_EXCL</font><font color="4444FF">)</font> <font color="4444FF">|</font><font color="4444FF">|</font> <font color="4444FF">(</font><font color="#2040a0">flags</font> <font color="4444FF">&amp;</font> 
<font color="#2040a0">O_TRUNC</font><font color="4444FF">)</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
      <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
  	<font color="4444FF"><strong>}</strong></font>
  	
  	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
  
    <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">open</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">flags</font><font color="4444FF">)</font><font color="4444FF">;</font>
 
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <font color="#2040a0">close</font><font color="4444FF">(</font><font color="#2040a0">res</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_read</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">buf</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font>, <font color="#2040a0">off_t</font> <font color="#2040a0">offset</font>, <strong>struct</strong> <font color="#2040a0">fuse_file_info</font> 
<font color="4444FF">*</font><font color="#2040a0">finfo</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>int</strong> <font color="#2040a0">fd</font><font color="4444FF">;</font>
    <strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
    <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">finfo</font><font color="4444FF">;</font>

	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">fd</font> <font color="4444FF">=</font> <font color="#2040a0">open</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">O_RDONLY</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">fd</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
        <strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font> 
    <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">pread</font><font color="4444FF">(</font><font color="#2040a0">fd</font>, <font color="#2040a0">buf</font>, <font color="#2040a0">size</font>, <font color="#2040a0">offset</font><font color="4444FF">)</font><font color="4444FF">;</font>
    
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
	<font color="4444FF"><strong>}</strong></font>
    <font color="#2040a0">close</font><font color="4444FF">(</font><font color="#2040a0">fd</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_write</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">buf</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font>, <font color="#2040a0">off_t</font> <font color="#2040a0">offset</font>, <strong>struct</strong> 
<font color="#2040a0">fuse_file_info</font> <font color="4444FF">*</font><font color="#2040a0">finfo</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">buf</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">size</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">offset</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">finfo</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_statfs</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>struct</strong> <font color="#2040a0">statvfs</font> <font color="4444FF">*</font><font color="#2040a0">st_buf</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
  <font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
  
  <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">statvfs</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">st_buf</font><font color="4444FF">)</font><font color="4444FF">;</font>
  <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
  <strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
    <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
  <font color="4444FF"><strong>}</strong></font>
  <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_release</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>struct</strong> <font color="#2040a0">fuse_file_info</font> <font color="4444FF">*</font><font color="#2040a0">finfo</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">finfo</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_fsync</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>int</strong> <font color="#2040a0">crap</font>, <strong>struct</strong> <font color="#2040a0">fuse_file_info</font> <font color="4444FF">*</font><font color="#2040a0">finfo</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">path</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">crap</font><font color="4444FF">;</font>
  <font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font> <font color="#2040a0">finfo</font><font color="4444FF">;</font>
  <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_access</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>int</strong> <font color="#2040a0">mode</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
  	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
  	
  	<font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">access</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">mode</font><font color="4444FF">)</font><font color="4444FF">;</font>
	<font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
  	<strong>if</strong> <font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
    	<strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
  	<font color="4444FF"><strong>}</strong></font>
  	<strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<font color="#444444">/*
 * Set the value of an extended attribute
 */</font>
<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_setxattr</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">name</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">value</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font>, <strong>int</strong> 
<font color="#2040a0">flags</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">name</font><font color="4444FF">;</font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">value</font><font color="4444FF">;</font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">size</font><font color="4444FF">;</font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">flags</font><font color="4444FF">;</font>
	<strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<font color="#444444">/*
 * Get the value of an extended attribute.
 */</font>
<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_getxattr</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">name</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">value</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
    <strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
    
    <font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">lgetxattr</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">name</font>, <font color="#2040a0">value</font>, <font color="#2040a0">size</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

<font color="#444444">/*
 * List the supported extended attributes.
 */</font>
<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_listxattr</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">list</font>, <font color="#2040a0">size_t</font> <font color="#2040a0">size</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<strong>int</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>
	
	<font color="#2040a0">path</font><font color="4444FF">=</font><font color="#2040a0">translate_path</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
	<font color="#2040a0">res</font> <font color="4444FF">=</font> <font color="#2040a0">llistxattr</font><font color="4444FF">(</font><font color="#2040a0">path</font>, <font color="#2040a0">list</font>, <font color="#2040a0">size</font><font color="4444FF">)</font><font color="4444FF">;</font>
   	<font color="#2040a0">free</font><font color="4444FF">(</font><font color="#2040a0">path</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>if</strong><font color="4444FF">(</font><font color="#2040a0">res</font> <font color="4444FF">=</font><font color="4444FF">=</font> <font color="4444FF">-</font><font color="#FF0000">1</font><font color="4444FF">)</font> <font color="4444FF"><strong>{</strong></font>
        <strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">errno</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
    <strong>return</strong> <font color="#2040a0">res</font><font color="4444FF">;</font>

<font color="4444FF"><strong>}</strong></font>

<font color="#444444">/*
 * Remove an extended attribute.
 */</font>
<strong>static</strong> <strong>int</strong> <font color="#2040a0">callback_removexattr</font><font color="4444FF">(</font><strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">path</font>, <strong>const</strong> <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">name</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">path</font><font color="4444FF">;</font>
  	<font color="4444FF">(</font><strong>void</strong><font color="4444FF">)</font><font color="#2040a0">name</font><font color="4444FF">;</font>
  	<strong>return</strong> <font color="4444FF">-</font><font color="#2040a0">EPERM</font><font color="4444FF">;</font>

<font color="4444FF"><strong>}</strong></font>

<strong>struct</strong> <font color="#2040a0">fuse_operations</font> <font color="#2040a0">callback_oper</font> <font color="4444FF">=</font> <font color="4444FF"><strong>{</strong></font>
    .<font color="#2040a0">getattr</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_getattr</font>,
    .<font color="#2040a0">readlink</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_readlink</font>,
    .<font color="#2040a0">readdir</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_readdir</font>,
    .<font color="#2040a0">mknod</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_mknod</font>,
    .<font color="#2040a0">mkdir</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_mkdir</font>,
    .<font color="#2040a0">symlink</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_symlink</font>,
    .<font color="#2040a0">unlink</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_unlink</font>,
    .<font color="#2040a0">rmdir</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_rmdir</font>,
    .<font color="#2040a0">rename</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_rename</font>,
    .<font color="#2040a0">link</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_link</font>,
    .<font color="#2040a0">chmod</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_chmod</font>,
    .<font color="#2040a0">chown</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_chown</font>,
    .<font color="#2040a0">truncate</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_truncate</font>,
    .<font color="#2040a0">utime</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_utime</font>,
    .<font color="#2040a0">open</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_open</font>,
    .<font color="#2040a0">read</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_read</font>,
    .<font color="#2040a0">write</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_write</font>,
    .<font color="#2040a0">statfs</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_statfs</font>,
    .<font color="#2040a0">release</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_release</font>,
    .<font color="#2040a0">fsync</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_fsync</font>,
    .<font color="#2040a0">access</font>		<font color="4444FF">=</font> <font color="#2040a0">callback_access</font>,

    <font color="#444444">/* Extended attributes support for userland interaction */</font>
    .<font color="#2040a0">setxattr</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_setxattr</font>,
    .<font color="#2040a0">getxattr</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_getxattr</font>,
    .<font color="#2040a0">listxattr</font>	<font color="4444FF">=</font> <font color="#2040a0">callback_listxattr</font>,
    .<font color="#2040a0">removexattr</font><font color="4444FF">=</font> <font color="#2040a0">callback_removexattr</font>
<font color="4444FF"><strong>}</strong></font><font color="4444FF">;</font>

<strong>int</strong> <font color="#2040a0">main</font><font color="4444FF">(</font><strong>int</strong> <font color="#2040a0">argc</font>, <strong>char</strong> <font color="4444FF">*</font><font color="#2040a0">argv</font><font color="4444FF">[</font><font color="4444FF">]</font><font color="4444FF">)</font>
<font color="4444FF"><strong>{</strong></font>
	
	<font color="#2040a0">rw_path</font> <font color="4444FF">=</font> <font color="#2040a0">getenv</font><font color="4444FF">(</font><font color="#008000">&quot;ROFS_RW_PATH&quot;</font><font color="4444FF">)</font><font color="4444FF">;</font>
  	<strong>if</strong> <font color="4444FF">(</font><font color="4444FF">!</font><font color="#2040a0">rw_path</font><font color="4444FF">)</font>
    <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">fprintf</font><font color="4444FF">(</font><font color="#2040a0">stderr</font>, <font color="#008000">&quot;ROFS_RW_PATH not defined in environment.<font color="#77dd77">\n</font>&quot;</font><font color="4444FF">)</font><font color="4444FF">;</font>
      <font color="#2040a0">exit</font><font color="4444FF">(</font><font color="#FF0000">1</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <font color="4444FF"><strong>}</strong></font>
	
    
    <font color="#2040a0">fuse_main</font><font color="4444FF">(</font><font color="#2040a0">argc</font>, <font color="#2040a0">argv</font>, <font color="4444FF">&amp;</font><font color="#2040a0">callback_oper</font><font color="4444FF">)</font><font color="4444FF">;</font>
    <strong>return</strong> <font color="#FF0000">0</font><font color="4444FF">;</font>
<font color="4444FF"><strong>}</strong></font>

</pre>
<hr>
syntax highlighted by <a href="http://www.palfrader.org/code2html">Code2HTML</a>, v. 0.9.1
</body>
</html>
